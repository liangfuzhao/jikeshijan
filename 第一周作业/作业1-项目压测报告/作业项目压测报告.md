# 项目接口性能报告分析

## 01-测试目的

​	分析公司调度中心（dispatch-center）接口性能瓶颈

## 02-测试工具

| 工具                                  | 作用                       |
| ------------------------------------- | -------------------------- |
| Jmeter、InfluxDB                      | 压测接口相关数据采集和存储 |
| Grafana                               | 压测数据可视化             |
| Nginx、Tomcat、MySQL、Redis、RabbitMQ | 压测接口功能实现           |

## 03-压测配置

场景：用户访问接口逐渐增加的场景模拟

| 模块           | 配置信息                                             |
| -------------- | ---------------------------------------------------- |
| 接口预相应时间 | 50ms                                                 |
| 线程梯度       | 5、10、15、20、25、30、35、40个线程                  |
| 循环次数       | 5000                                                 |
| 时间估算       | Ramp-Up都为1,50ms * 5000 * 8 = 33分                  |
| 配置断言       | 超过3秒，状态码不为"message":"success"，则为异常请求 |

## 04-接口性能瓶颈剖析

### 场景描述

- 一个获取center调度信息的接口，使用了Redis作为旁路缓存，缓存没有再从数据库查找的接口，使用了Nginx作反向代理

### 1、梯度压测结果

#### **聚合报告：**

![1687014310811](.\作业项目压测报告.assets\1687014310811.png)

#### 活跃线程数：

![1687012006671](.\作业项目压测报告.assets\1687012006671.png)

#### TPS：

![1687012028235](.\作业项目压测报告.assets\1687012028235.png)

#### RT：

![1687012062525](.\作业项目压测报告.assets\1687012062525.png)

![1687012095503](.\作业项目压测报告.assets\1687012095503.png)

#### 系统资源：

- 由于是对公司已部署的项目接口分析，无法获取到项目部署服务器的资源信息；这里只获取了 hero4_grafana_influxDB_promethes 这台服务器的资源信息

![1687014733401](.\作业项目压测报告.assets\1687014733401.png)

### 2、问题

#### 1）执行到25个线程组时，TPS达到瓶颈，最大吞吐量为480/s

![1687017665385](.\作业项目压测报告.assets\1687017665385.png)

![1687017733086](.\作业项目压测报告.assets\1687017733086.png)

**结论：**随着并发线程数的增加，TPS逐渐达到瓶颈

**原因分析及优化方案：**

| 原因                                                         | 优化方案                                   |
| ------------------------------------------------------------ | ------------------------------------------ |
| 业务逻辑复杂，长事务的影响                                   | 优化业务逻辑，降低耦合度，拆分成多个小事务 |
| 缓存命中率低                                                 | 缓存预热                                   |
| 低效的SQL语句，用的组合索引并非最优的索引，而且不是聚簇索引，会涉及一个回表的耗时 | 查询条件采用最优索引                       |

#### 2）随着压力增加，RT耗时也在增加

![1687019242347](.\作业项目压测报告.assets\1687019242347.png)

**原因及优化方案：**

| 原因                       | 优化方案     |
| -------------------------- | ------------ |
| 并发线程数增加，需要抢占锁 | 细化锁的粒度 |
| Redis缓存命中低，集中查库  | 数据预热     |

